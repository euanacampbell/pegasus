
<!doctype html>
<html lang="en">
  <head>
    <!-- Default -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="assets/pegasus_icon.jpg">

    <title>Pegasus - SQL Config</title>

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  </head>
  
    <body>
      {% if message['type']=='success' %}
      <div class="alert alert-success" role="alert">
        {{ message['message'] }}
      </div>
      {% elif message['type']=='error' %}
      <div class="alert alert-danger" role="alert">
        {{ message['message'] }}
      </div>
      {% endif %}

      <div class="container">

        <a href="/" class="btn btn-primary">Home</a>
        
        <!-- SETTINGS -->
        <h3>Settings</h3>
        <form name="settingsForm" action="/sqlsetup/updatesettings" style="padding: 10px; margin-bottom: 15px; margin-top: 15px;" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
          <div class="form-check">
            <input name="auto_format_queries" class="form-check-input" type="checkbox" value="" id="auto_format_queries_check" {% if config['auto_format_queries']==True %}checked{% endif %}>
            <label class="form-check-label" for="auto_format_queries_check">
              auto_format_queries
            </label>
          </div>
          <div class="form-check">
            <input name="better_tables" class="form-check-input" type="checkbox" value="" id="better_tables_check" {% if config['better_tables']==True %}checked{% endif %}>
            <label class="form-check-label" for="better_tables_check">
              better_tables
            </label>
          </div>
          <button type="submit" class="btn btn-primary">Save</button>
        </form>
        <!-- END OF SETTINGS -->

        <hr/>
        

        <!-- CONNECTIONS -->

        <h3>Connections</h3>
        <button type="button" class="btn btn-success" data-toggle="modal" data-target="#newConnModal">
          Add 
        </button>

        <div class="row">
        
        <div class="col-md-12">
          <table class="table">
            <thead>
              <tr>
                <th scope="col">name</th>
                <th scope="col">type</th>
                <th scope="col">server</th>
                <th scope="col">database</th>
                <th scope="col">username</th>
                <th scope="col">password</th>
                <th scope="col"></th>
                <th scope="col"></th>
              </tr>
            </thead>
            <tbody>
              {% for conn in config['connections'] %}
              <form name="update_conn_form" id="update_conn_form" method="POST" action="/sqlsetup/updateconn" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
              <input name="connName"  value="{{ conn }}" style="margin: 0px; padding: 0px;" type="text" class="form-control invisible" id="connName" placeholder="connection name" hidden>
                <tr> <!--TABLE ROW-->
                <td>{{ conn }}</td>
                <td>
                  <div class="input-group mb-3">
                    <select value="d" name="type" id="type" class="custom-select" id="inputGroupSelect01">
                      <option {% if config['connections'][conn]['type']=='mysql' %} selected="selected"{% endif %} value="mysql">MySQL</option>
                      <option {% if config['connections'][conn]['type']=='sqlserver' %} selected="selected"{% endif %} value="sqlserver">SQL Server</option>
                      <option {% if config['connections'][conn]['type']=='azure' %} selected="selected"{% endif %} value="azure">Azure Server</option>
                    </select>
                  </div>
                </td>
                <td><input name="server" value="{{ config['connections'][conn]['server'] }}" type="text" class="form-control" id="basic-url" aria-describedby="basic-addon3"></td>
                <td><input name="database" value="{{ config['connections'][conn]['database'] }}" type="text" class="form-control" id="basic-url" aria-describedby="basic-addon3"></td>
                <td><input name="username" value="{{ config['connections'][conn]['username'] }}" type="text" class="form-control" id="basic-url" aria-describedby="basic-addon3"></td>
                <td><input name="password" value="{{ config['connections'][conn]['password'] }}" type="password" class="form-control" id="basic-url" aria-describedby="basic-addon3"></td>
                <td><button type="submit" class="btn btn-primary"><i class="fa fa-save"></i></button></td>
                <td><button type="button" class="btn btn-danger" data-toggle="modal" data-target="#delete{{conn}}Modal"><i class="fa fa-trash-o"></i></button></td>
              </tr><!--TABLE ROW-->
              </form>
              {% endfor %}
          </table>
          </div>
          </div>
          
        

        <!-- END OF CONNECTIONS -->
        
        <hr/>


        <!-- QUERIES -->
        <h3>Queries</h3>
        <button type="button" class="btn btn-success" data-toggle="modal" data-target="#newQueryModal">
          Add 
        </button>
        
        <div class="row">
        {% for query in config['queries'] %}
        
        <div class="col-sm-6, col-md-4, col-lg-4">
          <form name="{{query}}Form" onsubmit="update_combi(this, '{{ query }}');" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
            <div class="card" style="width: 100%; margin: 5px;">
              <div class="card-header">
                <h5>{{ query }}</h5> 
              </div>
              <div class="card-body">
                  <!-- <input type="text" class="form-control" value="{{ query }}" placeholder="description">  -->
                  <div class="input-group mb-3">
                  <div class="input-group-prepend">
                    <label class="input-group-text" for="inputGroupSelect01">connection</label>
                  </div>
                  <select value="d" name="connection" id="connection" class="custom-select" id="inputGroupSelect01">
                    {% for conn in config['connections'] %}
                    <option {% if config['queries'][query]['connection']==conn %} selected="selected"{% endif %} value="{{conn}}">{{conn}}</option>
                    {% endfor %}
                  </select>
                </div>
                <textarea class="form-control" id="exampleFormControlTextarea1" style='overflow: auto; margin-bottom: 5px;' rows="{{ config['queries'][query]['query'].split('\n') | length }}">{{ config['queries'][query]['query'] }}</textarea>

              </div>
              <div class="card-footer">
                <button type="submit" class="btn btn-primary"><i class="fa fa-save"></i></button>
                <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#delete{{query}}Modal"><i class="fa fa-trash-o"></i></button> 
              </div>
            </div>
          </form>
        </div>
          
        
        {% endfor %}
        </div>
        <!-- END OF QUERIES -->

                <hr/>

        <!-- COMMANDS -->

        <h3>Commands</h3>
        <button type="button" class="btn btn-success" data-toggle="modal" data-target="#newCommandModal">
          Add
        </button>

        <div class="row">
        {% for command in config['commands'] %}
        
        <div class="col-sm-6, col-md-4, col-lg-4">
          <form name="update_command_form" id="update_command_form" method="POST" action="/sqlsetup/updatecommand" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></form>
          
            <div class="card" style="width: 100%; margin: 5px;">
              <div class="card-header">
                <h5>{{ command }}</h5> 
              </div>
              <div class="card-body">
                
                <input name="commandName"  value="{{ command }}" style="margin: 0px; padding: 0px;" type="text" class="form-control invisible" id="commandName" placeholder="command name" hidden>

                {% for query in config['queries'] %}
                <div class="form-check">
                  <input name="{{query}}" class="form-check-input" type="checkbox" value="{{query}}" id="{{query}}" {% if query in config['commands'][command]['queries'] %}checked{% endif %}>
                  <label class="form-check-label" for="auto_format_queries_check">{{ query }}</label>
                </div>
                {% endfor %}

                
              </div>
              <div class="card-footer">
                  <button type="submit" class="btn btn-primary"><i class="fa fa-save"></i></button>
                  <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#delete{{command}}Modal"><i class="fa fa-trash-o"></i></button>
              </div>
            </div>
          </form>
        </div>
          
        
        {% endfor %}
        </div>

        <!-- END OF COMMANDS -->


      </div>
      



    <!-- MODALS -->

    <!-- add query -->
    <div class="modal fade" id="newQueryModal" tabindex="-1" role="dialog" aria-labelledby="newQueryModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="newQueryModalLabel">New Query</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form name="new_query_form" id="new_query_form" method="POST" action="/sqlsetup/newquery" style="padding: 10px; margin-bottom: 15px; margin-top: 15px;" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
              <input name="queryName" style="margin: 2px;" type="text" class="form-control" id="connName" placeholder="query name"> 
              <div class="input-group mb-3">
                  <div class="input-group-prepend">
                    <label class="input-group-text" for="inputGroupSelect01">connection</label>
                  </div>
                  <select value="d" name="connection" id="connection" class="custom-select" id="inputGroupSelect01">
                    {% for conn in config['connections'] %}
                    <option value="{{conn}}">{{conn}}</option>
                    {% endfor %}
                  </select>
                </div>
                <textarea name="query" class="form-control" id="exampleFormControlTextarea1" style='overflow: auto; margin-bottom: 5px;' rows=5></textarea>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-success">add</button>
              </form>
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>

    <!-- delete query -->
    {% for query in config['queries'] %}
    <div class="modal fade" id="delete{{query}}Modal" tabindex="-1" role="dialog" aria-labelledby="newQueryModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="newQueryModalLabel">Delete {{ query }}?</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-footer">
            <form action="/sqlsetup/deletequery/{{query}}">
                <button type="submit" class="btn btn-danger">Yes</button>
            </form>
            <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
          </div>
        </div>
      </div>
    </div>
    {% endfor %} 

    <!-- delete connection -->
    {% for conn in config['connections'] %}
    <div class="modal fade" id="delete{{conn}}Modal" tabindex="-1" role="dialog" aria-labelledby="newCombiModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="newconnModalLabel">Delete {{ conn }}?</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-footer">
            <form action="/sqlsetup/deleteconn/{{conn}}">
                <button type="submit" class="btn btn-danger">Yes</button>
            </form>
            <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}

    <!-- delete command -->
    {% for command in config['commands'] %}
    <div class="modal fade" id="delete{{command}}Modal" tabindex="-1" role="dialog" aria-labelledby="newCombiModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="newcommandModalLabel">Delete {{ command }}?</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-footer">
            <form action="/sqlsetup/deletecommand/{{command}}">
                <button type="submit" class="btn btn-danger">Yes</button>
            </form>
            <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
          </div>
        </div>
      </div>
    </div>
    {% endfor %} 

    <!-- add connection -->
    <div class="modal fade" id="newConnModal" tabindex="-1" role="dialog" aria-labelledby="newConnModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="newConnModalLabel">New Connection</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form name="new_conn_form" id="new_conn_form" method="POST" action="/sqlsetup/updateconn" style="padding: 10px; margin-bottom: 15px; margin-top: 15px;" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
              <input name="connName" style="margin: 2px;" type="text" class="form-control" id="connName" placeholder="connection name">
              <div class="input-group mb-3">
                <div class="input-group-prepend">
                  <label class="input-group-text" for="inputGroupSelect01">Type</label>
                </div>
                <select name="type" id="type" class="custom-select" id="inputGroupSelect01">
                  <option selected>Choose...</option>
                  <option value="mysql">MySQL</option>
                  <option value="sqlserver">SQL Server</option>
                  <option value="azure">Azure Server</option>
                </select>
              </div>
              <input name="server" style="margin: 2px;" type="text" class="form-control" id="server" placeholder="server">
              <input name="database" style="margin: 2px;" type="text" class="form-control" id="database" placeholder="database">
              <input name="username" style="margin: 2px;" type="text" class="form-control" id="username" placeholder="username (optional)">
              <input name="password" style="margin: 2px;" type="password" class="form-control" id="password" placeholder="password (optional)">
            
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-success">add</button>
              </form>
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>

    <!-- add command -->
    <div class="modal fade" id="newCommandModal" tabindex="-1" role="dialog" aria-labelledby="newCommandModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="newCommandModalLabel">New Command</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form name="new_command_form" id="new_command_form" method="POST" action="/sqlsetup/updatecommand" style="padding: 10px; margin-bottom: 15px; margin-top: 15px;" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
              <input name="commandName" style="margin: 2px;" type="text" class="form-control" id="commandName" placeholder="command name"> 
              {% for query in config['queries'] %}
                <div class="form-check">
                  <input name="{{query}}" class="form-check-input" type="checkbox" value="{{query}}" id="{{query}}">
                  <label class="form-check-label" for="auto_format_queries_check">{{ query }}</label>
                </div>
                {% endfor %}
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-success">add</button>
              </form>
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>





  <script>      
      function update_combi(form, combicommand) {
            console.log('update combi');
            form.action = '/updatecombi/' + combicommand;
          };
    </script>
  </body>
</html>
